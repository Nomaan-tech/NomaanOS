#!/usr/bin/env python3
# NomaanOS CLI tool

import sys
from src.nomaanos.core import info, hello
from src.nomaanos import config
from src.nomaanos import modules

def main():
    if len(sys.argv) == 1:
        print("NomaanOS CLI: try 'info', 'hello <name>', 'config', 'set <key> <value>', 'modules', or 'run <module>'")
        return

    cmd = sys.argv[1]

    if cmd == "info":
        print(info())

    elif cmd == "hello":
        name = sys.argv[2] if len(sys.argv) > 2 else "Nomaan"
        print(hello(name))

    elif cmd == "config":
        print("NomaanOS Config:", config.load())

    elif cmd == "set":
        if len(sys.argv) < 4:
            print("Usage: nomaan set <key> <value>")
            return
        
        key = sys.argv[2]
        value = sys.argv[3]

        # Auto type conversion
        if value.lower() in ("true", "false"):
            value = value.lower() == "true"
        elif value.isdigit():
            value = int(value)

        cfg = config.load()
        cfg[key] = value
        config.save(cfg)
        print("Updated:", cfg)

    elif cmd == "modules":
        print("Available modules:", modules.list_modules())

    elif cmd == "run":
        if len(sys.argv) < 3:
            print("Usage: nomaan run <module>")
            return
        module_name = sys.argv[2]
        print(modules.run(module_name))

    else:
        print("Unknown command:", cmd)


if __name__ == "__main__":
    main()
